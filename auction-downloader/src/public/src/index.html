<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>WoW AH</title>

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

	<style type="text/css" src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css"></style>
	<style type="text/css">
		#timeseries {
			position: absolute;

			width: 1200px;
			height: 400px;

			left: 0px;
			top: 50px;
			right: 0px;
			bottom: 0px;
		}
	</style>
</head>
<body>

	<input id="itemid" placeholder="Item Id" value="109693" />
	<div id="timeseries"></div>

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>
	<script type="text/javascript">
		function drawTimeseries (data, labels) {
			c3.generate({
				bindto: '#timeseries',
				data: {
					// x: '_id',
					// xFormat: '%Y-%m-%dT%H:%M:%S',
					json: data,
					keys: {
						value: ['volume', 'avgPrice'],
						x: '_id'
					}
				},
				// axes: {
				// 	avgPrice: 'y',
				// 	volume: 'y2'
				// },
				axis: {
					y2: {
						show: true,
						min: 0
					},
					y: {
						min: 0
					},
					x: {
						type: 'timeseries',
						tick: {
							format: function (xi) {
								return xi.toLocaleDateString();
							}
						}
					}
				}
			});
		}

		function requestData (itemId) {
			var request = new XMLHttpRequest();

			request.open('POST', '/v1/items/' + itemId, true);
			request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');

			request.onload = function () {
				if (request.status !== 200) {
					throw new Error('Request: Response was ' + request.status);
				}

				var data = JSON.parse(request.responseText, function (key, value) {
					if (
						typeof value === 'string' &&
						/^([0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]{3}Z)$/.test(value)
					) {
						value = new Date(value);
					}

					return value;
				});

				drawTimeseries(data, ['Date', 'Volume', 'Avg. Price']);
			};

			request.onerror = function (e) {
				throw e;
			};

			request.send({});
		}

		var itemId = parseInt(document.getElementById('itemid').value, 10);

		document.getElementById('itemid').onchangeÂ = function () {
			itemId = parseInt(this.value, 10);

			requestData(itemId);
		};

		requestData(itemId);
	</script>
</body>
</html>
